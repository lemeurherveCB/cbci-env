removeStrategy:
  rbac: SYNC
  items: NONE
items:
- kind: pipeline
  name: easily-resumable
  # concurrentBuild: false
  # properties:
  # - pipelineTriggers:
  #     triggers:
  #     - cron:
  #         spec: '@weekly'
  definition:
    cpsFlowDefinition:
      sandbox: true
      script: |
        input 'Proceed?'
        build job: JOB_NAME, wait: false
- kind: pipeline
  name: uses-agents
  # concurrentBuild: false
  # properties:
  # - pipelineTriggers:
  #     triggers:
  #     - cron:
  #         spec: 'H/15 * * * *'
  definition:
    cpsFlowDefinition:
      sandbox: true
      script: |
        parallel([0, 1].collectEntries {b -> ["branch-$b", {
          podTemplate {
            retry(count: 2, conditions: [kubernetesAgent(), nonresumable()]) {
              node(POD_LABEL) {
                stage('build') {
                  mockLoad 180
                }
                stage('publish') {
                  archiveArtifacts allowEmptyArchive: true, artifacts: 'mock-artifact-*.txt'
                  fingerprint 'mock-artifact-*.txt'
                  junit 'mock-junit.xml'
                }
              }
            }
          }
        }]})
        build job: JOB_NAME, wait: false
- kind: pipeline
  name: checkpointed
  # concurrentBuild: false
  # properties:
  # - pipelineTriggers:
  #     triggers:
  #     - cron:
  #         spec: '@daily'
  definition:
    cpsFlowDefinition:
      sandbox: true
      script: |
        podTemplate {
          node(POD_LABEL) {
            stage('beginning') {
              sh 'sleep 30'
              sh 'date > date.txt'
              stash name: 'stuff', includes: 'date.txt'
            }
          }
        }
        checkpoint 'middle'
        podTemplate {
          retry(count: 2, conditions: [kubernetesAgent(), nonresumable()]) {
            node(POD_LABEL) {
              stage('end') {
                unstash 'stuff'
                sh 'cat date.txt'
                sh 'sleep 1h'
              }
            }
          }
        }
        build job: JOB_NAME, wait: false
